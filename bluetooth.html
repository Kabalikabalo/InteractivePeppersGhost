<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>micro:bit Servo Controller</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h1>micro:bit Servo Controller</h1>

  <button id="connect">Connect micro:bit</button>

  <div style="margin-top:1rem;">
    <input id="angle" type="number" min="0" max="180" value="90" />
    <button id="send">Send Angle</button>
  </div>

  <div style="margin-top:1rem;">
    <input id="slider" type="range" min="0" max="180" value="90" />
    <span id="val">90</span>°
  </div>

  <script>
    // Nordic UART Service + RX (write) characteristic UUIDs
    const UART_SERVICE = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
    const UART_RX_CHAR = '6e400002-b5a3-f393-e0a9-e50e24dcca9e'; // write to peripheral
    // (TX notify char would be '6e400003-...' if you want to read back)

    let rxChar = null;

    document.getElementById('connect').addEventListener('click', async () => {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ services: [UART_SERVICE] }],
          optionalServices: [UART_SERVICE]
        });
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(UART_SERVICE);
        rxChar = await service.getCharacteristic(UART_RX_CHAR);
        alert('Connected!');
      } catch (e) {
        alert('Connect failed: ' + e);
      }
    });

    async function sendAngle(angle) {
      if (!rxChar) {
        alert('Not connected yet.');
        return;
      }
      // Clamp 0–180 and send with newline (micro:bit code reads until newline)
      angle = Math.max(0, Math.min(180, Number(angle)|0));
      const data = new TextEncoder().encode(angle.toString() + '\n');
      await rxChar.writeValue(data);
    }

    document.getElementById('send').addEventListener('click', () => {
      sendAngle(document.getElementById('angle').value);
    });

    const slider = document.getElementById('slider');
    const val = document.getElementById('val');
    slider.addEventListener('input', () => {
      val.textContent = slider.value;
      // Optional: live-send as you move the slider
      sendAngle(slider.value);
      document.getElementById('angle').value = slider.value;
    });
  </script>
</body>
</html>
